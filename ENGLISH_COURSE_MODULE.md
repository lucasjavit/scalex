# English Course Module - Documenta√ß√£o Completa

## üìö Vis√£o Geral

Sistema completo de aprendizado de ingl√™s que combina:
- **V√≠deo-aulas do YouTube** organizadas em est√°gios tem√°ticos
- **Flashcards estilo Cloze** (pergunta/resposta/exemplo)
- **Algoritmo SM-2** (Spaced Repetition) para otimiza√ß√£o de memoriza√ß√£o
- **Autonomia do usu√°rio** (pode pular units, estuda no pr√≥prio ritmo)

---

## üéØ Conceito Geral

### Diferen√ßa da Vers√£o Antiga

| Aspecto | Vers√£o Antiga ‚ùå | Vers√£o Nova ‚úÖ |
|---------|-----------------|---------------|
| **Estrutura** | Lessons por n√≠vel (A1, A2, B1...) | Stages tem√°ticos + Units |
| **Conte√∫do** | Perguntas m√∫ltipla escolha | V√≠deos do YouTube + Flashcards |
| **Revis√£o** | Deck por lesson | Deck global √∫nico |
| **Algoritmo** | Sem spaced repetition | SM-2 com intervalos progressivos |
| **Cards** | N√£o existiam | Cloze cards (pergunta/resposta/exemplo) |
| **Progresso** | Por lesson | Por stage/unit + cards individuais |
| **√Åudio** | N√£o tinha | Suporte a √°udio nos cards |
| **Autonomia** | Linear | Pode pular units |

---

## üèóÔ∏è Hierarquia de Conte√∫do

```
üì¶ ENGLISH COURSE
‚îÇ
‚îú‚îÄ‚îÄ üìÇ STAGE 1: Greetings & Introductions
‚îÇ   ‚îú‚îÄ‚îÄ üìπ Unit 1.1: How to say hello
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üé¥ 5 cards (criados pelo admin)
‚îÇ   ‚îú‚îÄ‚îÄ üìπ Unit 1.2: Introducing yourself
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üé¥ 5 cards (criados pelo admin)
‚îÇ   ‚îî‚îÄ‚îÄ üìπ Unit 1.3: Common greetings
‚îÇ       ‚îî‚îÄ‚îÄ üé¥ 5 cards (criados pelo admin)
‚îÇ
‚îú‚îÄ‚îÄ üìÇ STAGE 2: Travel English
‚îÇ   ‚îú‚îÄ‚îÄ üìπ Unit 2.1: At the airport
‚îÇ   ‚îú‚îÄ‚îÄ üìπ Unit 2.2: Booking a hotel
‚îÇ   ‚îî‚îÄ‚îÄ üìπ Unit 2.3: Asking for directions
‚îÇ
‚îú‚îÄ‚îÄ üìÇ STAGE 3: Business English
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ üîÑ GLOBAL REVIEW DECK (todos os cards em um s√≥ lugar)
```

**Caracter√≠sticas:**
- Stages t√™m ordem fixa (1, 2, 3...)
- Units dentro do stage t√™m ordem fixa
- Usu√°rio pode **pular** units se j√° souber o conte√∫do
- Cards v√£o todos para um **deck global de revis√£o**

---

## üíæ Estrutura do Banco de Dados

### 1. Tabela `stages`

Representa os blocos tem√°ticos grandes.

```sql
CREATE TABLE stages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  order_index INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_by UUID,
  updated_by UUID,
  deleted_at TIMESTAMP,
  deleted_by UUID
);

CREATE INDEX idx_stages_order ON stages(order_index);
CREATE INDEX idx_stages_deleted_at ON stages(deleted_at);
```

**Exemplo de dados:**
```json
{
  "id": "uuid-1",
  "title": "Greetings & Introductions",
  "description": "Learn the basics of greeting people and introducing yourself",
  "order_index": 1
}
```

---

### 2. Tabela `units`

Representa li√ß√µes individuais (cada uma com um v√≠deo do YouTube).

```sql
CREATE TABLE units (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  stage_id UUID NOT NULL REFERENCES stages(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  youtube_url VARCHAR(500) NOT NULL,
  thumbnail_url VARCHAR(500),
  video_duration INTEGER,
  order_index INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_by UUID,
  updated_by UUID,
  deleted_at TIMESTAMP,
  deleted_by UUID
);

CREATE INDEX idx_units_stage_id ON units(stage_id);
CREATE INDEX idx_units_order ON units(stage_id, order_index);
CREATE INDEX idx_units_deleted_at ON units(deleted_at);
```

**Exemplo de dados:**
```json
{
  "id": "uuid-10",
  "stage_id": "uuid-1",
  "title": "How to say hello",
  "description": "Learn different ways to greet someone in English",
  "youtube_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "thumbnail_url": "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
  "video_duration": 300,
  "order_index": 1
}
```

---

### 3. Tabela `cards`

Cards de flashcard no formato Cloze (pergunta ‚Üí resposta ‚Üí exemplo).

```sql
CREATE TABLE cards (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  unit_id UUID NOT NULL REFERENCES units(id) ON DELETE CASCADE,
  question TEXT NOT NULL,
  answer TEXT NOT NULL,
  example_sentence TEXT,
  audio_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_by UUID,
  updated_by UUID,
  deleted_at TIMESTAMP,
  deleted_by UUID
);

CREATE INDEX idx_cards_unit_id ON cards(unit_id);
CREATE INDEX idx_cards_deleted_at ON cards(deleted_at);
```

**Exemplo de dados:**
```json
{
  "id": "uuid-100",
  "unit_id": "uuid-10",
  "question": "How do you say 'hello' formally?",
  "answer": "Good morning / Good afternoon / Good evening",
  "example_sentence": "Good morning, Mr. Smith. How are you today?",
  "audio_url": "https://storage.example.com/audio/good-morning.mp3"
}
```

**Importante:**
- Cards s√£o **templates pr√©-criados pelo admin**
- Quando usu√°rio completa uma unit, esses cards s√£o **associados ao usu√°rio**
- Cards n√£o s√£o criados dinamicamente - s√£o pr√©-cadastrados

---

### 4. Tabela `user_stage_progress`

Rastreia quais stages o usu√°rio iniciou/completou.

```sql
CREATE TABLE user_stage_progress (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  stage_id UUID NOT NULL REFERENCES stages(id) ON DELETE CASCADE,
  is_completed BOOLEAN DEFAULT FALSE,
  started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completed_at TIMESTAMP,

  UNIQUE(user_id, stage_id)
);

CREATE INDEX idx_user_stage_progress_user_id ON user_stage_progress(user_id);
CREATE INDEX idx_user_stage_progress_stage_id ON user_stage_progress(stage_id);
```

**L√≥gica:**
- Registro criado quando usu√°rio abre um stage pela primeira vez
- `is_completed = TRUE` quando **todas as units** do stage forem completadas

---

### 5. Tabela `user_unit_progress`

Rastreia progresso de visualiza√ß√£o de v√≠deos e conclus√£o de units.

```sql
CREATE TABLE user_unit_progress (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  unit_id UUID NOT NULL REFERENCES units(id) ON DELETE CASCADE,
  watch_time_seconds INTEGER DEFAULT 0,
  is_completed BOOLEAN DEFAULT FALSE,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE(user_id, unit_id)
);

CREATE INDEX idx_user_unit_progress_user_id ON user_unit_progress(user_id);
CREATE INDEX idx_user_unit_progress_unit_id ON user_unit_progress(unit_id);
```

**Fluxo:**
1. Usu√°rio abre uma unit e come√ßa a assistir o v√≠deo
2. Frontend atualiza `watch_time_seconds` periodicamente (a cada 10 segundos)
3. Quando `watch_time_seconds >= video_duration * 0.8` (80%), bot√£o "Completar" √© habilitado
4. Usu√°rio clica em "Completar Unit"
5. Backend marca `is_completed = TRUE` e **cria cards** para o usu√°rio

**Autonomia:**
- Usu√°rio pode clicar em "Pular Unit" sem assistir 80%
- Neste caso, cards **n√£o s√£o criados** automaticamente
- Pode voltar depois e completar

---

### 6. Tabela `user_card_progress` ‚≠ê (MAIS IMPORTANTE)

Cora√ß√£o do sistema de spaced repetition. Rastreia o progresso individual de cada card.

```sql
CREATE TABLE user_card_progress (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  card_id UUID NOT NULL REFERENCES cards(id) ON DELETE CASCADE,

  -- Campos do algoritmo SM-2
  ease_factor DECIMAL(3,2) DEFAULT 2.5,
  interval INTEGER DEFAULT 0,
  repetitions INTEGER DEFAULT 0,

  -- Estado do card
  state VARCHAR(20) DEFAULT 'new',

  -- Agendamento
  next_review_date TIMESTAMP NOT NULL,
  last_reviewed_at TIMESTAMP,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  UNIQUE(user_id, card_id)
);

CREATE INDEX idx_user_card_progress_user_id ON user_card_progress(user_id);
CREATE INDEX idx_user_card_progress_card_id ON user_card_progress(card_id);
CREATE INDEX idx_user_card_progress_next_review ON user_card_progress(next_review_date);
CREATE INDEX idx_user_card_progress_state ON user_card_progress(state);
```

**Explica√ß√£o dos campos:**

| Campo | Descri√ß√£o |
|-------|-----------|
| `ease_factor` | Fator de facilidade (1.3 a 2.5). Controla qu√£o r√°pido os intervalos crescem. Valor inicial: 2.5 |
| `interval` | Intervalo em **MINUTOS** (n√£o dias!). Ex: 1, 10, 1440 (1 dia), 7200 (5 dias), 43200 (30 dias) |
| `repetitions` | Quantas vezes acertou o card seguidas. Quando marca "De novo", volta para 0 |
| `state` | 'new' (nunca estudado), 'learning' (intervalos curtos), 'review' (intervalos longos) |
| `next_review_date` | Data/hora exata da pr√≥xima revis√£o. Calculado como: `NOW() + interval minutos` |
| `last_reviewed_at` | √öltima vez que o card foi revisado |

**Exemplo de registro:**
```json
{
  "id": "uuid-1000",
  "user_id": "uuid-user-1",
  "card_id": "uuid-100",
  "ease_factor": 2.3,
  "interval": 7200,
  "repetitions": 3,
  "state": "review",
  "next_review_date": "2025-10-31T14:30:00Z",
  "last_reviewed_at": "2025-10-26T14:30:00Z"
}
```

---

### 7. Tabela `review_sessions`

Hist√≥rico de todas as revis√µes (para estat√≠sticas e an√°lise).

```sql
CREATE TABLE review_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  card_id UUID NOT NULL REFERENCES cards(id) ON DELETE CASCADE,
  result VARCHAR(20) NOT NULL,
  time_taken_seconds INTEGER,
  ease_factor_after DECIMAL(3,2),
  interval_after INTEGER,
  reviewed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_review_sessions_user_id ON review_sessions(user_id);
CREATE INDEX idx_review_sessions_card_id ON review_sessions(card_id);
CREATE INDEX idx_review_sessions_reviewed_at ON review_sessions(reviewed_at);
```

**Usado para:**
- Dashboard de estat√≠sticas (quantos cards revisados hoje, taxa de acerto)
- Gr√°ficos de progresso ao longo do tempo
- Identificar cards dif√≠ceis (muitos "wrong")

---

### 8. Sistema de Auditoria (Audit System)

**Implementa√ß√£o:**
As entidades principais (`stages`, `units`, `cards`) estendem a classe base `AuditEntity`, que fornece campos de rastreamento autom√°tico:

```typescript
// back-end/src/common/entities/audit.entity.ts
export abstract class AuditEntity {
  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;

  @Column({ type: 'uuid', nullable: true, name: 'created_by' })
  createdBy: string;

  @UpdateDateColumn({ name: 'updated_at' })
  updatedAt: Date;

  @Column({ type: 'uuid', nullable: true, name: 'updated_by' })
  updatedBy: string;

  @DeleteDateColumn({ name: 'deleted_at', nullable: true })
  deletedAt: Date;

  @Column({ type: 'uuid', nullable: true, name: 'deleted_by' })
  deletedBy: string;
}
```

**Campos de Auditoria:**

| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `created_at` | TIMESTAMP | Data/hora de cria√ß√£o (autom√°tico) |
| `created_by` | UUID | ID do usu√°rio que criou o registro |
| `updated_at` | TIMESTAMP | Data/hora da √∫ltima atualiza√ß√£o (autom√°tico) |
| `updated_by` | UUID | ID do usu√°rio que fez a √∫ltima atualiza√ß√£o |
| `deleted_at` | TIMESTAMP | Data/hora de soft delete (null se n√£o deletado) |
| `deleted_by` | UUID | ID do usu√°rio que deletou o registro |

**Soft Delete:**
- Registros N√ÉO s√£o removidos do banco de dados
- Campo `deleted_at` √© preenchido com timestamp da dele√ß√£o
- Queries devem filtrar registros onde `deleted_at IS NULL`
- Permite recupera√ß√£o de dados e auditoria completa

**Benef√≠cios:**
- Rastreamento completo de a√ß√µes administrativas
- Possibilidade de reverter dele√ß√µes acidentais
- Compliance com regulamenta√ß√µes (LGPD, GDPR)
- Auditoria para investiga√ß√£o de problemas

---

## üß† Algoritmo SM-2 (Spaced Repetition)

### O que √© SM-2?

**SM-2 (SuperMemo 2)** √© um algoritmo de **spaced repetition** (repeti√ß√£o espa√ßada) criado em 1987.

**Princ√≠pio:**
> Voc√™ deve revisar informa√ß√µes **pouco antes de esquec√™-las**. Se voc√™ revisa muito cedo, perde tempo. Se revisa muito tarde, j√° esqueceu.

**Como funciona:**
- Intervalos crescem exponencialmente quando voc√™ acerta
- Intervalos resetam quando voc√™ erra
- "Facilidade" de cada card √© ajustada individualmente

---

### Estados dos Cards

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  Primeira   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  Acertou 3+  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   NEW   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄvez‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ LEARNING ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄvezes‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ REVIEW  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ                          ‚îÇ
                              ‚îÇ Errou (wrong)            ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     (volta pra learning)
```

**NEW (Novo):**
- Card que o usu√°rio nunca viu
- `repetitions = 0`
- `next_review_date = NOW()` (dispon√≠vel imediatamente)

**LEARNING (Aprendendo):**
- Card que est√° sendo aprendido
- Intervalos curtos: 1min, 10min
- `repetitions < 3`
- Se acertar 3 vezes, vira REVIEW

**REVIEW (Revis√£o):**
- Card j√° aprendido
- Intervalos longos: dias, semanas, meses
- `repetitions >= 3`
- Se errar (wrong), volta para LEARNING

---

### Intervalos Progressivos

**Para cards NOVOS (state='new'):**
```
Primeira vez: <1 minuto (se errar ou dif√≠cil)
Segunda vez: <10 minutos
Terceira vez: 1 dia
Quarta vez: 5 dias
```

**Para cards em REVIEW (state='review'):**
```
F√≥rmula: novo_intervalo = intervalo_anterior √ó ease_factor

Exemplo com ease_factor = 2.5:
5 dias ‚Üí 12 dias ‚Üí 30 dias ‚Üí 75 dias ‚Üí 6 meses ‚Üí 1.5 anos ‚Üí 3.7 anos
```

---

### C√°lculo de Intervalo

```typescript
function calculateNextReview(
  cardProgress: CardProgress,
  result: 'wrong' | 'hard' | 'good' | 'easy'
): CardProgress {

  let { ease_factor, interval, repetitions, state } = cardProgress;

  // Constantes
  const MIN_EASE = 1.3;
  const MAX_EASE = 2.5;

  // ========================================
  // RESULTADO: WRONG (De novo) üî¥
  // ========================================
  if (result === 'wrong') {
    ease_factor = Math.max(MIN_EASE, ease_factor - 0.2);
    interval = 1;                    // 1 minuto
    repetitions = 0;                 // Reseta
    state = 'learning';
  }

  // ========================================
  // RESULTADO: HARD (Dif√≠cil) üü°
  // ========================================
  else if (result === 'hard') {
    ease_factor = Math.max(MIN_EASE, ease_factor - 0.15);

    if (state === 'new') {
      interval = 1;                  // 1 minuto
      repetitions = 0;
      state = 'learning';
    }
    else if (state === 'learning') {
      interval = 10;                 // 10 minutos
      repetitions = Math.min(repetitions + 1, 2);
    }
    else { // review
      interval = Math.round(interval * 1.2);
      repetitions++;
    }
  }

  // ========================================
  // RESULTADO: GOOD (Bom) üü¢
  // ========================================
  else if (result === 'good') {
    if (state === 'new') {
      interval = 1;                  // 1 minuto
      repetitions = 1;
      state = 'learning';
    }
    else if (state === 'learning') {
      if (repetitions === 0) {
        interval = 10;               // 10 minutos
        repetitions = 1;
      }
      else if (repetitions === 1) {
        interval = 1440;             // 1 dia
        repetitions = 2;
      }
      else {
        interval = 7200;             // 5 dias
        repetitions = 3;
        state = 'review';
      }
    }
    else { // review
      interval = Math.round(interval * ease_factor);
      repetitions++;
    }
  }

  // ========================================
  // RESULTADO: EASY (F√°cil) üîµ
  // ========================================
  else if (result === 'easy') {
    ease_factor = Math.min(MAX_EASE, ease_factor + 0.1);

    if (state === 'new' || state === 'learning') {
      interval = 7200;               // 5 dias
      repetitions = 3;
      state = 'review';
    }
    else { // review
      interval = Math.round(interval * ease_factor * 1.3);
      repetitions++;
    }
  }

  const next_review_date = new Date(Date.now() + interval * 60 * 1000);

  return {
    ease_factor,
    interval,
    repetitions,
    state,
    next_review_date
  };
}
```

---

### Exemplo Pr√°tico de Progress√£o

**Card: "What is 'apple' in Portuguese?"**

```
üìÖ Dia 1 - 10:00
Estado: NEW
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 1min, state = LEARNING, next_review = 10:01

üìÖ Dia 1 - 10:01
Estado: LEARNING (rep=1)
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 10min, next_review = 10:11

üìÖ Dia 1 - 10:11
Estado: LEARNING (rep=2)
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 1440min (1 dia), next_review = Dia 2 10:11

üìÖ Dia 2 - 10:11
Estado: LEARNING (rep=3)
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 7200min (5 dias), state = REVIEW, next_review = Dia 7 10:11

üìÖ Dia 7 - 10:11
Estado: REVIEW (rep=4, ease=2.5)
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 18000min (12.5 dias), next_review = Dia 19

üìÖ Dia 19
Estado: REVIEW (rep=5, ease=2.5)
Usu√°rio revisa ‚Üí Clica "Good" üü¢
Resultado: interval = 45000min (31 dias), next_review = Dia 50

üìÖ Dia 50
Estado: REVIEW (rep=6, ease=2.5)
Usu√°rio revisa ‚Üí Clica "Easy" üîµ
ease_factor = 2.6
Resultado: interval = 152100min (105 dias), next_review = Dia 155
```

**Se errar:**
```
üìÖ Dia 50
Estado: REVIEW (rep=6, ease=2.5)
Usu√°rio revisa ‚Üí Clica "Wrong" üî¥
Resultado: interval = 1min, repetitions = 0, state = LEARNING
RECOME√áA DO ZERO!
```

---

## üîÑ Fluxos de Uso

### Fluxo 1: Usu√°rio Estuda uma Nova Unit

```
1Ô∏è‚É£ Usu√°rio entra no Dashboard
   ‚ñº
2Ô∏è‚É£ Clica no Stage "Greetings & Introductions"
   - Backend cria registro em user_stage_progress (se n√£o existir)
   ‚ñº
3Ô∏è‚É£ V√™ lista de units do stage
   - Unit 1.1: How to say hello ‚úÖ (completado)
   - Unit 1.2: Introducing yourself ‚¨ÖÔ∏è (voc√™ est√° aqui)
   - Unit 1.3: Common greetings (pode pular se quiser)
   ‚ñº
4Ô∏è‚É£ Clica em "Unit 1.2: Introducing yourself"
   - Frontend cria registro em user_unit_progress (se n√£o existir)
   - Mostra p√°gina com:
     * YouTube player (iframe)
     * Descri√ß√£o da unit
     * Bot√£o "Completar Unit" (desabilitado)
   ‚ñº
5Ô∏è‚É£ Usu√°rio assiste o v√≠deo
   - Frontend atualiza watch_time_seconds a cada 10 segundos
   - Quando watch_time >= video_duration * 0.8:
     * Bot√£o "Completar Unit" fica HABILITADO
   ‚ñº
6Ô∏è‚É£ Usu√°rio clica "Completar Unit"
   - Backend:
     ‚úì Marca is_completed = TRUE em user_unit_progress
     ‚úì Busca todos os cards desta unit
     ‚úì Para cada card, cria registro em user_card_progress:
       {
         state: 'new',
         ease_factor: 2.5,
         interval: 0,
         repetitions: 0,
         next_review_date: NOW()
       }
   - Frontend mostra notifica√ß√£o:
     "‚úÖ Unit completada! 5 novos cards adicionados ao seu deck de revis√£o"
```

**Op√ß√£o alternativa: Pular Unit**

```
4Ô∏è‚É£ Usu√°rio clica "Pular Unit"
   - Backend: N√ÉO cria cards
   - Usu√°rio pode continuar para pr√≥xima unit
   - Pode voltar depois e completar
```

---

### Fluxo 2: Sess√£o de Revis√£o (Review Session)

```
1Ô∏è‚É£ Usu√°rio clica "Iniciar Revis√£o" no Dashboard
   ‚ñº
2Ô∏è‚É£ Backend busca cards dispon√≠veis:
   - WHERE user_id = ? AND next_review_date <= NOW()
   - Ordena por: state ASC, next_review_date ASC
   - Limite: m√°ximo 20 cards por sess√£o
   ‚ñº
3Ô∏è‚É£ Frontend mostra interface de revis√£o:

   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ     üé¥ Review Session (1/20)        ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                     ‚îÇ
   ‚îÇ  ‚ùì Pergunta:                       ‚îÇ
   ‚îÇ  How do you say 'hello' formally?   ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  [ üëÅÔ∏è Mostrar Resposta ]            ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

   ‚ñº Usu√°rio clica "Mostrar Resposta"

   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ     üé¥ Review Session (1/20)        ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                     ‚îÇ
   ‚îÇ  ‚ùì Pergunta:                       ‚îÇ
   ‚îÇ  How do you say 'hello' formally?   ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  ‚úÖ Resposta:                       ‚îÇ
   ‚îÇ  Good morning / Good afternoon      ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  üìù Exemplo:                        ‚îÇ
   ‚îÇ  Good morning, Mr. Smith.           ‚îÇ
   ‚îÇ  How are you today?                 ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  üîä [Play Audio]                    ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  Como foi?                          ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  [üî¥ De novo]  [üü° Dif√≠cil]        ‚îÇ
   ‚îÇ    <1 min        <10 min            ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  [üü¢ Bom]      [üîµ F√°cil]          ‚îÇ
   ‚îÇ    1 dia         5 dias             ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

   ‚ñº
4Ô∏è‚É£ Usu√°rio escolhe dificuldade
   - Frontend envia:
     POST /api/english-course/review
     {
       card_id: "uuid-100",
       result: "good",
       time_taken_seconds: 8
     }
   ‚ñº
5Ô∏è‚É£ Backend processa:
   - Busca user_card_progress atual
   - Chama calculateNextReview(progress, "good")
   - Atualiza user_card_progress com novos valores
   - Cria registro em review_sessions
   ‚ñº
6Ô∏è‚É£ Frontend avan√ßa para pr√≥ximo card
   - Repete at√© terminar todos os 20 cards
   ‚ñº
7Ô∏è‚É£ Fim da sess√£o - mostra estat√≠sticas:

   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ     üéâ Sess√£o Completa!             ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                     ‚îÇ
   ‚îÇ  Voc√™ revisou 20 cards!             ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  üìä Estat√≠sticas:                   ‚îÇ
   ‚îÇ  üî¥ De novo: 2 (10%)                ‚îÇ
   ‚îÇ  üü° Dif√≠cil: 5 (25%)                ‚îÇ
   ‚îÇ  üü¢ Bom: 10 (50%)                   ‚îÇ
   ‚îÇ  üîµ F√°cil: 3 (15%)                  ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  ‚è±Ô∏è Pr√≥xima revis√£o em: 30 min     ‚îÇ
   ‚îÇ  (voc√™ tem 5 cards prontos)         ‚îÇ
   ‚îÇ                                     ‚îÇ
   ‚îÇ  [Revisar mais] [Voltar]            ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Fluxo 3: Dashboard e Progresso

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üéì English Course - Dashboard                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  üìä Seu Progresso Hoje:                            ‚îÇ
‚îÇ  ‚îú‚îÄ üé¥ 20 cards revisados                          ‚îÇ
‚îÇ  ‚îú‚îÄ ‚úÖ 85% taxa de acerto                          ‚îÇ
‚îÇ  ‚îú‚îÄ ‚è±Ô∏è 15 min de estudo                            ‚îÇ
‚îÇ  ‚îî‚îÄ üî• 7 dias de sequ√™ncia!                        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  üîÑ Revis√£o:                                        ‚îÇ
‚îÇ  ‚îú‚îÄ üÜï 5 cards novos dispon√≠veis                   ‚îÇ
‚îÇ  ‚îú‚îÄ üìö 12 cards em aprendizado                     ‚îÇ
‚îÇ  ‚îú‚îÄ ‚ôªÔ∏è 3 cards para revisar agora                  ‚îÇ
‚îÇ  ‚îî‚îÄ [üöÄ Iniciar Revis√£o]                           ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  üìÇ Stages:                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Stage 1: Greetings         ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    3/3 units completadas      ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%      ‚îÇ                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  ‚îÇ üîÑ Stage 2: Travel English    ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    1/5 units completadas      ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 20%        ‚îÇ                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  ‚îÇ üîí Stage 3: Business English  ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    0/4 units completadas      ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ    ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%        ‚îÇ                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Dados calculados:**
- **Cards revisados hoje**: COUNT de `review_sessions` WHERE `reviewed_at >= TODAY`
- **Taxa de acerto**: % de cards com result='good' ou 'easy'
- **Sequ√™ncia**: Quantos dias consecutivos com pelo menos 1 card revisado
- **Cards novos**: COUNT WHERE `state='new' AND next_review_date <= NOW()`
- **Cards em aprendizado**: COUNT WHERE `state='learning'`
- **Cards para revisar**: COUNT WHERE `next_review_date <= NOW()`

---

## üóÇÔ∏è Estrutura de C√≥digo

### Backend (NestJS)

```
back-end/src/
‚îÇ
‚îú‚îÄ‚îÄ üìÅ common/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ entities/
‚îÇ       ‚îî‚îÄ‚îÄ audit.entity.ts          (base class com campos de auditoria)
‚îÇ
‚îî‚îÄ‚îÄ üìÅ modules/english-learning/course/
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÅ entities/
    ‚îÇ   ‚îú‚îÄ‚îÄ stage.entity.ts           (extends AuditEntity)
    ‚îÇ   ‚îú‚îÄ‚îÄ unit.entity.ts            (extends AuditEntity)
    ‚îÇ   ‚îú‚îÄ‚îÄ card.entity.ts            (extends AuditEntity)
    ‚îÇ   ‚îú‚îÄ‚îÄ user-stage-progress.entity.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ user-unit-progress.entity.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ user-card-progress.entity.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ review-session.entity.ts
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÅ dto/
    ‚îÇ   ‚îú‚îÄ‚îÄ create-stage.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ update-stage.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ create-unit.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ update-unit.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ create-card.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ update-card.dto.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ complete-unit.dto.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ review-card.dto.ts
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÅ services/
    ‚îÇ   ‚îú‚îÄ‚îÄ stages.service.ts          (CRUD de stages + audit)
    ‚îÇ   ‚îú‚îÄ‚îÄ units.service.ts            (CRUD de units + audit)
    ‚îÇ   ‚îú‚îÄ‚îÄ cards.service.ts            (CRUD de cards + audit)
    ‚îÇ   ‚îú‚îÄ‚îÄ progress.service.ts         (l√≥gica de progresso)
    ‚îÇ   ‚îú‚îÄ‚îÄ review.service.ts           (l√≥gica de revis√£o)
    ‚îÇ   ‚îî‚îÄ‚îÄ sm2.service.ts              (algoritmo SM-2)
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÅ controllers/
    ‚îÇ   ‚îú‚îÄ‚îÄ stages.controller.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ units.controller.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ cards.controller.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ progress.controller.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ review.controller.ts
    ‚îÇ
    ‚îî‚îÄ‚îÄ english-course.module.ts
```

---

### Frontend (React)

```
front-end/src/modules/english-learning/course/
‚îÇ
‚îú‚îÄ‚îÄ üìÅ components/
‚îÇ   ‚îú‚îÄ‚îÄ StageCard.jsx              (card visual do stage)
‚îÇ   ‚îú‚îÄ‚îÄ UnitCard.jsx               (card visual da unit)
‚îÇ   ‚îú‚îÄ‚îÄ VideoPlayer.jsx            (YouTube iframe)
‚îÇ   ‚îú‚îÄ‚îÄ ReviewCard.jsx             (interface de revis√£o)
‚îÇ   ‚îú‚îÄ‚îÄ ProgressBar.jsx            (barra de progresso)
‚îÇ   ‚îú‚îÄ‚îÄ StatsWidget.jsx            (widget de estat√≠sticas)
‚îÇ   ‚îî‚îÄ‚îÄ ReviewButton.jsx           (bot√µes de dificuldade)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ pages/
‚îÇ   ‚îú‚îÄ‚îÄ CourseDashboard.jsx        (dashboard principal)
‚îÇ   ‚îú‚îÄ‚îÄ StageView.jsx              (lista de units)
‚îÇ   ‚îú‚îÄ‚îÄ UnitView.jsx               (v√≠deo + descri√ß√£o)
‚îÇ   ‚îî‚îÄ‚îÄ ReviewSession.jsx          (sess√£o de revis√£o)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ services/
‚îÇ   ‚îî‚îÄ‚îÄ courseApi.js               (chamadas HTTP)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useStages.js
‚îÇ   ‚îú‚îÄ‚îÄ useUnits.js
‚îÇ   ‚îú‚îÄ‚îÄ useReview.js
‚îÇ   ‚îî‚îÄ‚îÄ useProgress.js
‚îÇ
‚îî‚îÄ‚îÄ üìÅ utils/
    ‚îú‚îÄ‚îÄ sm2.js                     (l√≥gica SM-2 no frontend)
    ‚îî‚îÄ‚îÄ timeFormatter.js           (formatar intervalos)
```

---

## üåê API Endpoints

### Stages

```
GET    /api/english-course/stages
       Retorna todos os stages (ordenados por order_index)

GET    /api/english-course/stages/:id
       Retorna um stage espec√≠fico

POST   /api/english-course/stages (ADMIN)
       Cria novo stage
       Body: { title, description, order_index }

PATCH  /api/english-course/stages/:id (ADMIN)
       Atualiza stage

DELETE /api/english-course/stages/:id (ADMIN)
       Deleta stage
```

### Units

```
GET    /api/english-course/stages/:stageId/units
       Retorna todas as units de um stage

GET    /api/english-course/units/:id
       Retorna uma unit espec√≠fica

POST   /api/english-course/units (ADMIN)
       Cria nova unit
       Body: {
         stage_id,
         title,
         description,
         youtube_url,
         thumbnail_url,
         video_duration,
         order_index
       }

PATCH  /api/english-course/units/:id (ADMIN)
       Atualiza unit

DELETE /api/english-course/units/:id (ADMIN)
       Deleta unit
```

### Cards

```
GET    /api/english-course/units/:unitId/cards
       Retorna todos os cards de uma unit

GET    /api/english-course/cards/:id
       Retorna um card espec√≠fico

POST   /api/english-course/cards (ADMIN)
       Cria novo card
       Body: {
         unit_id,
         question,
         answer,
         example_sentence,
         audio_url
       }

PATCH  /api/english-course/cards/:id (ADMIN)
       Atualiza card

DELETE /api/english-course/cards/:id (ADMIN)
       Deleta card
```

### Progress

```
GET    /api/english-course/progress/dashboard
       Retorna estat√≠sticas do dashboard do usu√°rio
       Response: {
         stats_today: {
           cards_reviewed,
           accuracy_rate,
           study_time,
           streak
         },
         cards_due: {
           new,
           learning,
           review
         },
         stages_progress: [
           {
             stage,
             units_completed,
             units_total,
             percentage
           }
         ]
       }

GET    /api/english-course/progress/stages/:stageId
       Retorna progresso do usu√°rio em um stage espec√≠fico

POST   /api/english-course/progress/units/:unitId/start
       Marca que usu√°rio come√ßou a assistir uma unit

PATCH  /api/english-course/progress/units/:unitId/update-watch-time
       Atualiza tempo assistido
       Body: { watch_time_seconds }

POST   /api/english-course/progress/units/:unitId/complete
       Completa uma unit e cria cards para o usu√°rio
       Response: { cards_created: 5 }

POST   /api/english-course/progress/units/:unitId/skip
       Pula uma unit (n√£o cria cards)
```

### Review

```
GET    /api/english-course/review/due
       Retorna cards dispon√≠veis para revisar
       Query params: ?limit=20
       Response: {
         cards: [...],
         has_more: boolean
       }

POST   /api/english-course/review/submit
       Envia resultado de uma revis√£o
       Body: {
         card_id,
         result: 'wrong'|'hard'|'good'|'easy',
         time_taken_seconds
       }
       Response: {
         next_review_date,
         interval,
         state
       }

GET    /api/english-course/review/stats
       Retorna estat√≠sticas de revis√£o
       Query params: ?period=today|week|month
       Response: {
         total_reviews,
         results_breakdown: {
           wrong: 2,
           hard: 5,
           good: 10,
           easy: 3
         },
         average_time
       }
```

---

## üéØ Configura√ß√µes Fixas

**Algoritmo SM-2:**
- `ease_factor` inicial: 2.5
- `ease_factor` m√≠nimo: 1.3
- `ease_factor` m√°ximo: 2.5
- Intervalo "Wrong": 1 minuto
- Intervalo "Hard": 10 minutos
- Intervalo "Good" (learning): 1 dia (1440 min)
- Intervalo "Easy" (learning): 5 dias (7200 min)
- Ajuste ease "Easy": +0.1
- Ajuste ease "Hard": -0.15
- Ajuste ease "Wrong": -0.2
- Threshold learning‚Üíreview: 3 repeti√ß√µes

**Limites:**
- Cards novos por dia: 20
- Cards por sess√£o: 20

**V√≠deo:**
- Threshold de conclus√£o: 80%
- Auto-criar cards: Sim
- Permitir pular: Sim

---

## üìã Fluxo de Cria√ß√£o de Conte√∫do (Admin)

### 1. Admin Cria Stage

```
POST /api/english-course/stages
{
  "title": "Greetings & Introductions",
  "description": "Learn the basics of greeting people",
  "order_index": 1
}
```

### 2. Admin Cria Units no Stage

```
POST /api/english-course/units
{
  "stage_id": "uuid-stage-1",
  "title": "How to say hello",
  "description": "Learn different ways to greet someone",
  "youtube_url": "https://www.youtube.com/watch?v=...",
  "thumbnail_url": "https://img.youtube.com/vi/.../maxresdefault.jpg",
  "video_duration": 300,
  "order_index": 1
}
```

### 3. Admin Cria Cards para a Unit

```
POST /api/english-course/cards
{
  "unit_id": "uuid-unit-1",
  "question": "How do you say 'hello' formally?",
  "answer": "Good morning / Good afternoon / Good evening",
  "example_sentence": "Good morning, Mr. Smith. How are you today?",
  "audio_url": "https://storage.example.com/audio/good-morning.mp3"
}

// Repetir para criar 5 cards por unit
```

---

## ‚úÖ Resumo Final

Este m√≥dulo √© um **sistema completo de aprendizado de ingl√™s** que:

1. ‚úÖ Organiza conte√∫do em **Stages tem√°ticos** ‚Üí **Units com v√≠deos**
2. ‚úÖ Usa **flashcards Cloze** (pergunta/resposta/exemplo)
3. ‚úÖ Implementa **algoritmo SM-2** para memoriza√ß√£o otimizada
4. ‚úÖ D√° **autonomia** ao usu√°rio (pode pular, revisar no pr√≥prio ritmo)
5. ‚úÖ Rastreia **progresso detalhado** (stages, units, cards individuais)
6. ‚úÖ Mostra **estat√≠sticas** e gamifica√ß√£o suave (sequ√™ncias, taxa de acerto)
7. ‚úÖ Suporta **√°udio** para pron√∫ncia correta

**Fluxo principal:**
```
Assiste v√≠deo ‚Üí Completa unit ‚Üí Cards criados ‚Üí Revisa cards ‚Üí
Intervalos crescem ‚Üí Memoriza√ß√£o de longo prazo
```

---

## üìù Status da Implementa√ß√£o

### ‚úÖ Completado

1. ‚úÖ Migration do TypeORM com todas as 7 tabelas criadas
2. ‚úÖ Entities no backend implementadas (Stage, Unit, Card, UserStageProgress, UserUnitProgress, UserCardProgress, ReviewSession)
3. ‚úÖ Servi√ßo SM-2 implementado com algoritmo completo
4. ‚úÖ Controllers e services criados (Stages, Units, Cards, Progress, Review)
5. ‚úÖ Testes unit√°rios completos (57 testes passando)
6. ‚úÖ Sistema de auditoria implementado (AuditEntity base class)
7. ‚úÖ Migration de auditoria executada (colunas created_by, updated_by, deleted_at, deleted_by)
8. ‚úÖ Soft delete configurado em todas as entidades principais

### üîÑ Pr√≥ximos Passos

1. **Atualizar services para popular campos de auditoria:**
   - Adicionar `userId` como par√¢metro em m√©todos create/update/delete
   - Popular campos `createdBy`, `updatedBy`, `deletedBy` automaticamente

2. **Implementar soft delete nos services:**
   - Criar m√©todo `softDelete(id, userId)` nos services
   - Adicionar filtro `deletedAt IS NULL` em queries de listagem

3. **Atualizar controllers:**
   - Re-adicionar guards de autentica√ß√£o quando sistema de auth estiver pronto
   - Extrair `userId` do request autenticado
   - Passar `userId` para os m√©todos dos services

4. **Criar componentes React do frontend:**
   - Dashboard principal
   - Interface de stages e units
   - Player de v√≠deo
   - Interface de revis√£o de cards

5. **Implementar painel admin:**
   - CRUD de stages, units, cards
   - Visualiza√ß√£o de logs de auditoria

6. **Testar fluxo completo end-to-end:**
   - Assistir v√≠deo ‚Üí completar unit ‚Üí revisar cards
   - Verificar soft delete funcionando
   - Validar auditoria sendo registrada corretamente
